<?php
set_time_limit(0);


//set variables
$cmd = "get";
$server = "http://polldaddy.com";
$script = "/ratings/rate.php?";
$id = "4340776";
$unique_id = "";
$item_id = "";
$title="";
$permalink="";
$r = 5;
$type = "stars";
$loginpassw = "";

//set headers
$headers[] = "Accept: text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5"; 
$headers[] = "Connection: keep-alive"; 
$headers[] = "Keep-Alive: 115"; 
$headers[] = "Accept-Charset: ISO-8859-1,utf-8;q=0.7,*;q=0.7"; 
$headers[] = "Accept-Language: en-us,en;q=0.5"; 
$headers[] = "Pragma: ";
$cookie = tempnam ("/tmp", "cookie"); 

//get proxy list
$proxies[] = "";

foreach($proxies as $proxy){
	$token = "";
	//get current poll data
	$cmd = "get";
	$url = $server.$script."cmd=".$cmd."&id=".$id."&uid=".$unique_id."&item_id=".$item_id;

	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 
	curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); 
	curl_setopt($ch, CURLOPT_USERAGENT,'Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1');
	curl_setopt($ch, CURLOPT_ENCODING, 'gzip,deflate'); 
	curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); 
	curl_setopt($ch, CURLOPT_PROXY, $proxy);
	curl_setopt($ch, CURLOPT_PROXYUSERPWD, $loginpassw);
	curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30);
	$data=curl_exec($ch);
	curl_close($ch);

	//extract data
	print_r($data);
	$arrays = explode(";",$data);

	//get average rating
	$rating = explode(" ",$arrays[0]);
	$rating = $rating[2];

	//get number of votes
	$votes = explode(" ",$arrays[1]);
	$votes = $votes[2];

	//get token
	$token = explode("'",$arrays[4]);
	$token = $token[1];

	//submit rating
	$cmd = "rate";
	$url = $server.$script."title=".$title."&permalink=".$permalink."&type=".$type."&id=".$id."&r=".$r."&uid=".$unique_id."&item_id=".$item_id."&votes=".$votes."&avg=".$rating."&cmd=".$cmd."&token=".$token;
	if($token==""){
		echo "Couldn't vote: no token.";
	}
	else{
		$ch = curl_init();
		curl_setopt($ch, CURLOPT_URL, $url);
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); 
		curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); 
		curl_setopt($ch, CURLOPT_USERAGENT,'Mozilla/5.0 (Windows NT 5.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1');
		curl_setopt($ch, CURLOPT_ENCODING, 'gzip,deflate'); 
		curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); 
		curl_setopt($ch, CURLOPT_PROXY, $proxy);
		curl_setopt($ch, CURLOPT_PROXYUSERPWD, $loginpassw);
		curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30);
		$data=curl_exec($ch);
		curl_close($ch);
		echo "------------------------------------------------------------<br />";
		print_r($data);
		echo "------------------------------------------------------------<br />";
		echo $proxy." voted<br />";
	}
}
